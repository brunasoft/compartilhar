<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Problemas e Soluções Contábeis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-primary-50 to-primary-100 dark:from-gray-900 dark:to-gray-800 min-h-screen transition-all duration-300">
    <!-- Header -->
    <header class="bg-white/80 dark:bg-gray-800/80 glass-effect border-b border-primary-200 dark:border-gray-700 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-primary-500 to-primary-600 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 dark:text-white">Sistema Contábil</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Problemas e Soluções</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button id="themeToggle" class="p-2 rounded-lg bg-primary-100 dark:bg-gray-700 text-primary-600 dark:text-primary-400 hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors">
                        <svg id="sunIcon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg id="moonIcon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                    
                    <button id="addProblemBtn" class="bg-gradient-to-r from-primary-500 to-primary-600 text-white px-4 py-2 rounded-lg hover:from-primary-600 hover:to-primary-700 transition-all duration-200 flex items-center space-x-2 shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Novo Problema</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Module Filter -->
        <div class="mb-8">
            <div class="bg-white/80 dark:bg-gray-800/80 glass-effect rounded-xl p-6 shadow-lg border border-primary-200 dark:border-gray-700">
                <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Filtrar por Módulo</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3">
                    <button class="module-filter active bg-primary-500 text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition-colors text-sm font-medium" data-module="all">
                        Todos
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="folha-pagamento">
                        Folha de Pagamento
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="escrita-fiscal">
                        Escrita Fiscal
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="contabilidade-geral">
                        Contabilidade Geral
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="livro-caixa">
                        Livro Caixa
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="ativo-imobilizado">
                        Ativo Imobilizado
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="gerenciador-contabil">
                        Gerenciador Contábil
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="controle-tributos">
                        Controle de Tributos
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="demonstrativo-gado">
                        Demonstrativo de Gado
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="selecao-pessoal">
                        Seleção de Pessoal
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="protocolo">
                        Protocolo
                    </button>
                    <button class="module-filter bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg hover:bg-primary-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium" data-module="sindical">
                        Sindical
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-8">
            <div class="bg-white/80 dark:bg-gray-800/80 glass-effect rounded-xl p-4 shadow-lg border border-primary-200 dark:border-gray-700">
                <div class="relative">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input id="searchInput" type="text" placeholder="Buscar problemas ou soluções..." class="w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-700 border border-primary-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-800 dark:text-white">
                </div>
            </div>
        </div>

        <!-- Problems List -->
        <div id="problemsList" class="space-y-6">
            <!-- Problems will be dynamically loaded here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-16 hidden">
            <div class="bg-white/80 dark:bg-gray-800/80 glass-effect rounded-xl p-12 shadow-lg border border-primary-200 dark:border-gray-700">
                <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-300 mb-2">Nenhum problema encontrado</h3>
                <p class="text-gray-500 dark:text-gray-400 mb-6">Comece adicionando seu primeiro problema e solução</p>
                <button onclick="openModal()" class="bg-gradient-to-r from-primary-500 to-primary-600 text-white px-6 py-3 rounded-lg hover:from-primary-600 hover:to-primary-700 transition-all duration-200">
                    Adicionar Primeiro Problema
                </button>
            </div>
        </div>
    </main>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <h2 id="modalTitle" class="text-xl font-semibold text-gray-800 dark:text-white">Novo Problema</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <form id="problemForm" class="p-6 space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Módulo</label>
                        <select id="moduleSelect" required class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-800 dark:text-white">
                            <option value="">Selecione um módulo</option>
                            <option value="folha-pagamento">Folha de Pagamento</option>
                            <option value="escrita-fiscal">Escrita Fiscal</option>
                            <option value="contabilidade-geral">Contabilidade Geral</option>
                            <option value="livro-caixa">Livro Caixa</option>
                            <option value="ativo-imobilizado">Ativo Imobilizado</option>
                            <option value="gerenciador-contabil">Gerenciador Contábil</option>
                            <option value="controle-tributos">Controle de Tributos</option>
                            <option value="demonstrativo-gado">Demonstrativo de Gado</option>
                            <option value="selecao-pessoal">Seleção de Pessoal</option>
                            <option value="protocolo">Protocolo</option>
                            <option value="sindical">Sindical</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Título do Problema</label>
                        <input id="titleInput" type="text" required class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-800 dark:text-white" placeholder="Descreva o problema brevemente">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Descrição do Problema</label>
                        <textarea id="problemInput" required rows="4" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-800 dark:text-white resize-none" placeholder="Descreva o problema detalhadamente"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Solução</label>
                        <textarea id="solutionInput" required rows="4" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-800 dark:text-white resize-none" placeholder="Descreva a solução detalhadamente"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Imagem (opcional)</label>
                        <input id="imageInput" type="file" accept="image/*" class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-800 dark:text-white">
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Formatos aceitos: JPG, PNG, GIF (máx. 5MB)</p>
                    </div>
                    
                    <div class="flex space-x-4 pt-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-primary-500 to-primary-600 text-white py-3 rounded-lg hover:from-primary-600 hover:to-primary-700 transition-all duration-200 font-medium">
                            Salvar
                        </button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-300 py-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let problems = JSON.parse(localStorage.getItem('accountingProblems')) || [
            {
                id: '1',
                module: 'folha-pagamento',
                title: 'Estrutura do XML em desconformidade com XSD - elemento ideEstabLot',
                problem: 'A estrutura do arquivo XML está em desconformidade com o esquema XSD. The element \'ideEstabLot\' in namespace \'http://www.esocial.gov.br/schema/evt/evtDeslig/v_S_01_03_00\' has invalid child element \'infoAgNocivo\' in namespace \'http://www.esocial.gov.br/schema/evt/evtDeslig/v_S_01_03_00\'. List of possible elements expected: \'detVerbas\' in namespace.',
                solution: '📌 O que aconteceu:\n\nO evento S-2299 (Desligamento) exige obrigatoriamente o bloco <detVerbas>, que representa o holerite da rescisão (com salários, férias, 13º proporcional, multa FGTS, etc.).\n\nComo o recibo de rescisão não foi gerado, o XML foi montado sem esse bloco obrigatório, resultando no erro de estrutura. Sempre que um desligamento for gerado, é essencial emitir o recibo de rescisão, mesmo que haja outros erros a tratar. Caso contrário, o eSocial retornará erro de estrutura.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '2',
                module: 'folha-pagamento',
                title: 'Categoria do trabalhador incompatível com lotação e classificação tributária',
                problem: 'Categoria do trabalhador \'101\' incompatível com a lotação do tipo \'24\' e classificação tributária do empregador \'21\'.\n\nAção Sugerida: O valor informado no campo deverá ser compatível com a lotação e classificação tributária do empregador informada no evento de "Informações Cadastrais do Empregador", conforme Tabela 11 (Compatibilidade entre Categoria de Trabalhadores, Classificação Tributária e Tipos de Lotação).',
                solution: '📌 O que aconteceu:\n\nHouve divergência entre as informações do sistema e as registradas no eSocial, podendo ser:\n\n1. Categoria do trabalhador incorreta: A categoria cadastrada no sistema não é compatível com a exigida pelo eSocial.\n\n2. Lotação não cadastrada no eSocial: A lotação informada não foi cadastrada previamente no portal do eSocial com o código correto da empresa.\n\n⚠️ Essa informação não é enviada automaticamente pelo sistema, sendo necessário cadastrar manualmente no eSocial.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '3',
                module: 'folha-pagamento',
                title: 'Rubrica não existe no cadastro do empregador',
                problem: 'Rubrica de código \'0084\' e identificador de tabela \'000084\' não existe no cadastro do empregador para o período \'2025-07\'.\n\nAções Sugeridas:\n- Verifique se a rubrica está cadastrada na tabela de rubricas;\n- Confira o preenchimento das informações da rubrica;\n- Para rubricas da Tabela de Rubricas Padrão, o campo ideTabRubr deve ter valor igual a 1.',
                solution: '📌 O que aconteceu:\n\nA rubrica informada não existe no cadastro do eSocial. É necessário abrir o evento dessa rubrica no sistema, criar o registro e transmiti-lo ao eSocial.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '4',
                module: 'folha-pagamento',
                title: 'Empregador Web - Seguro Desemprego - Quantidade de registros incorreta',
                problem: 'EMPREGADOR WEB -- SEGURO DESEMPREGO\n\n"A quantidade de registros informada no arquivo difere da quantidade real."',
                solution: '📌 O que aconteceu:\n\nO Edson tentou importar o arquivo no sistema do Ministério do Trabalho e Emprego, mas o erro apareceu. Ao validar no Validador Empregador Web, não foram apontados problemas, porém ao analisar o arquivo percebi que ele estava sem as informações do empregado.\n\nAcessei remotamente e, antes de gerar o arquivo do seguro, gerei o relatório do requerimento para confirmar se havia dados. Depois, selecionei o funcionário e gerei o arquivo novamente.\n\nO arquivo foi gerado corretamente e o envio funcionou. Orientei que, para outros casos semelhantes, seja sempre feito o relatório do requerimento antes da geração do arquivo.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '5',
                module: 'folha-pagamento',
                title: 'Evento em duplicidade no eSocial - Código 106',
                problem: 'Código: 106\n\nDescrição: Foi localizado no sistema um evento em duplicidade com o evento a ser enviado, mesmo Tipo de Inscrição, Número de Inscrição, CPF, Período de Apuração.',
                solution: '📌 O que aconteceu:\n\nEste erro ocorre quando já existe, no eSocial, um evento idêntico ao que está sendo enviado - mesmo tipo de evento, para o mesmo trabalhador e no mesmo período.\n\nNo eSocial, cada tipo de demonstrativo (rescisão, 13º salário, férias, adiantamento de salário e folha normal) é classificado de acordo com sua natureza.\n\nNo caso das Remunerações, todos são enviados como evento S-1200.\n\n💡 Exemplo prático:\n\nImagine um funcionário que saiu de férias no meio do mês. Ele terá:\n- Férias (período de afastamento)\n- Saldo de salário (dias trabalhados antes das férias)\n\nAmbos são considerados remunerações e, portanto, identificados como S-1200.\n\nSe o usuário gerar apenas as férias e enviá-las ao eSocial, o sistema já registrará um S-1200 para aquele período.\n\nDepois, ao tentar enviar o saldo de salário separadamente, o eSocial acusará duplicidade, pois já existe um S-1200 registrado para aquele mesmo mês.\n\n✅ Como resolver:\n\n- Exclua o evento S-1200 que já está no eSocial.\n- Gere os dois demonstrativos juntos (férias + saldo de salário) e envie em um único envio.\n- Assim, o eSocial reconhecerá que eles pertencem ao mesmo período e aceitará normalmente.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '6',
                module: 'folha-pagamento',
                title: 'Evento de remuneração não localizado - Código 724',
                problem: 'Código: 724\n\nDescrição: Não foi localizado um evento de remuneração do trabalhador para o período e com o mesmo demonstrativo de pagamento.\n\nAção Sugerida: Deve ser um valor atribuído pela fonte pagadora em S-1200, S-1202 ou S-1207 no campo Identificador de Recibo de Pagamento, obedecendo a relação:\n- Tipo de Pagamento = [1] → evento S-1200\n- Tipo de Pagamento = [4] → evento S-1202\n- Tipo de Pagamento = [5] → evento S-1207',
                solution: '📌 O que aconteceu:\n\nEste erro ocorre quando o usuário tenta enviar um pagamento sem que a respectiva remuneração tenha sido enviada e aceita pelo eSocial.\n\nO caso mais comum é com recibos de férias:\n\n1. O usuário envia o evento de férias (S-1200) mas não envia o saldo de salário.\n\n2. Na hora de transmitir os pagamentos, o pagamento das férias é aceito, mas o do saldo apresenta o erro 724, pois o eSocial não encontrou o demonstrativo de remuneração correspondente.\n\n✅ Como resolver:\n\n1. Excluir do eSocial o evento de férias já enviado.\n\n2. Gerar e enviar juntos:\n   - O evento de férias\n   - O saldo de salário (quando houver)\n\n3. Caso haja algum erro ao subir esses eventos, corrija antes de tentar enviar os pagamentos.\n\n4. Quando ambos os eventos forem aceitos pelo eSocial, envie todos os pagamentos juntos, evitando erro de duplicidade.\n\n5. Se algum pagamento já tiver sido enviado separadamente, exclua e reenvie junto com os demais.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '7',
                module: 'folha-pagamento',
                title: 'Somatório dos Proventos menor que Descontos',
                problem: '"O somatório dos Proventos deve ser maior ou igual ao somatório dos Descontos".',
                solution: '📌 O que aconteceu:\n\nEste erro ocorre quando, no demonstrativo enviado ao eSocial, o total dos proventos (valores a receber) é menor que o total dos descontos, o que não é permitido.\n\nAs causas mais comuns são:\n\n1. Valor incorreto ou desatualizado no recibo de férias\n   - O cálculo pode estar errado ou incompleto.\n   - Solução: Recalcular ou relançar as férias de forma correta.\n\n2. Diferença entre as rubricas do sistema e as do eSocial\n   - As rubricas (códigos de eventos de folha) não estão compatíveis com o cadastro do eSocial.\n   - Solução: Ajustar as rubricas para que sejam idênticas às cadastradas no eSocial.\n\n3. Tipos de recibo configurados incorretamente\n   - Um tipo de recibo incorreto pode impactar no cálculo da folha.\n   - Solução: Revisar a configuração dos tipos de recibo no sistema.\n\n4. Rubricas iguais entre sistema e eSocial, mas divergentes dentro do próprio evento\n   - O evento pode ter sido configurado com tributações e incidências diferentes das rubricas criadas.\n   - Solução: Conferir os valores e corrigir.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: '8',
                module: 'folha-pagamento',
                title: 'Informação cadastral do empregador não encontrada',
                problem: '"É necessário existir informação cadastral do empregador para o período. Ação Sugerida - Verificar se já foi enviado um evento de cadastramento do empregador."',
                solution: '📌 A uninfe está como Homologação, mude para Produção.',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
        let currentFilter = 'all';
        let currentSearch = '';
        let editingId = null;

        // Module names mapping
        const moduleNames = {
            'folha-pagamento': 'Folha de Pagamento',
            'escrita-fiscal': 'Escrita Fiscal',
            'contabilidade-geral': 'Contabilidade Geral',
            'livro-caixa': 'Livro Caixa',
            'ativo-imobilizado': 'Ativo Imobilizado',
            'gerenciador-contabil': 'Gerenciador Contábil',
            'controle-tributos': 'Controle de Tributos',
            'demonstrativo-gado': 'Demonstrativo de Gado',
            'selecao-pessoal': 'Seleção de Pessoal',
            'protocolo': 'Protocolo',
            'sindical': 'Sindical'
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            setupEventListeners();
            renderProblems();
        });

        // Theme management
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            if (isDark) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('addProblemBtn').addEventListener('click', () => openModal());
            document.getElementById('problemForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Module filter buttons
            document.querySelectorAll('.module-filter').forEach(btn => {
                btn.addEventListener('click', (e) => handleModuleFilter(e.target.dataset.module));
            });
        }

        // Modal management
        function openModal(problemId = null) {
            editingId = problemId;
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const form = document.getElementById('problemForm');
            
            if (problemId) {
                const problem = problems.find(p => p.id === problemId);
                modalTitle.textContent = 'Editar Problema';
                fillForm(problem);
            } else {
                modalTitle.textContent = 'Novo Problema';
                form.reset();
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('fade-in');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
            modal.classList.remove('fade-in');
            editingId = null;
        }

        function fillForm(problem) {
            document.getElementById('moduleSelect').value = problem.module;
            document.getElementById('titleInput').value = problem.title;
            document.getElementById('problemInput').value = problem.problem;
            document.getElementById('solutionInput').value = problem.solution;
        }

        // Form handling
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                module: document.getElementById('moduleSelect').value,
                title: document.getElementById('titleInput').value,
                problem: document.getElementById('problemInput').value,
                solution: document.getElementById('solutionInput').value,
                image: null,
                createdAt: editingId ? problems.find(p => p.id === editingId).createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            const imageFile = document.getElementById('imageInput').files[0];
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    formData.image = e.target.result;
                    saveProblem(formData);
                };
                reader.readAsDataURL(imageFile);
            } else {
                if (editingId) {
                    const existingProblem = problems.find(p => p.id === editingId);
                    formData.image = existingProblem.image;
                }
                saveProblem(formData);
            }
        }

        function saveProblem(formData) {
            if (editingId) {
                const index = problems.findIndex(p => p.id === editingId);
                problems[index] = { ...formData, id: editingId };
            } else {
                const newProblem = {
                    ...formData,
                    id: Date.now().toString()
                };
                problems.unshift(newProblem);
            }
            
            localStorage.setItem('accountingProblems', JSON.stringify(problems));
            renderProblems();
            closeModal();
        }

        // Search and filter
        function handleSearch(e) {
            currentSearch = e.target.value.toLowerCase();
            renderProblems();
        }

        function handleModuleFilter(module) {
            currentFilter = module;
            
            // Update button states
            document.querySelectorAll('.module-filter').forEach(btn => {
                btn.classList.remove('active', 'bg-primary-500', 'text-white');
                btn.classList.add('bg-primary-100', 'dark:bg-gray-700', 'text-primary-700', 'dark:text-primary-300');
            });
            
            const activeBtn = document.querySelector(`[data-module="${module}"]`);
            activeBtn.classList.add('active', 'bg-primary-500', 'text-white');
            activeBtn.classList.remove('bg-primary-100', 'dark:bg-gray-700', 'text-primary-700', 'dark:text-primary-300');
            
            renderProblems();
        }

        // Rendering
        function renderProblems() {
            const container = document.getElementById('problemsList');
            const emptyState = document.getElementById('emptyState');
            
            const filteredProblems = problems.filter(problem => {
                const matchesFilter = currentFilter === 'all' || problem.module === currentFilter;
                const matchesSearch = currentSearch === '' || 
                    problem.title.toLowerCase().includes(currentSearch) ||
                    problem.problem.toLowerCase().includes(currentSearch) ||
                    problem.solution.toLowerCase().includes(currentSearch);
                
                return matchesFilter && matchesSearch;
            });
            
            if (filteredProblems.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredProblems.map(problem => `
                <div class="problem-card bg-white/80 dark:bg-gray-800/80 glass-effect rounded-xl shadow-lg border border-primary-200 dark:border-gray-700 overflow-hidden fade-in">
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <span class="module-badge bg-primary-100 dark:bg-gray-700 text-primary-700 dark:text-primary-300 px-3 py-1 rounded-full text-sm font-medium">
                                    ${moduleNames[problem.module]}
                                </span>
                                <span class="text-sm text-gray-500 dark:text-gray-400">
                                    ${formatDate(problem.updatedAt)}
                                </span>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="openModal('${problem.id}')" class="text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button onclick="deleteProblem('${problem.id}')" class="text-gray-400 hover:text-red-600 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">${problem.title}</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                    </svg>
                                    Problema
                                </h4>
                                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-line">${problem.problem}</p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Solução
                                </h4>
                                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-line">${problem.solution}</p>
                                </div>
                            </div>
                        </div>
                        
                        ${problem.image ? `
                            <div class="mt-4">
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Imagem</h4>
                                <img src="${problem.image}" alt="Imagem do problema" class="rounded-lg max-w-full h-auto border border-gray-200 dark:border-gray-600">
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function deleteProblem(id) {
            if (confirm('Tem certeza que deseja excluir este problema?')) {
                problems = problems.filter(problem => problem.id !== id);
                localStorage.setItem('accountingProblems', JSON.stringify(problems));
                renderProblems();
            }
        }

        // Make functions globally available
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.deleteProblem = deleteProblem;
    </script>
</body>
</html>
